---
short_description: Map API operations to Terraform CRUD methods
long_description: |
  Learn how to annotate OpenAPI operations as creating, reading, updating, or deleting
  remote entities using x-speakeasy-entity-operation annotations for Terraform provider generation.
source:
  repo: "speakeasy-api/speakeasy.com"
  path: "src/content/docs/terraform/guides/crud.mdx"
  ref: "af7c36a9ec957336fb799151a4e5af3ae293831e"
  last_reconciled: "2025-12-11"
---

# What is a Terraform Provider

A Terraform provider is a plugin that extends Terraform, allowing it to manage external resources such as cloud services. It serves as a mediator between Terraform and external APIs, using the Terraform Plugin Protocol for communication.

Terraform providers, built with the terraform-plugin-framework, include:

1. **Resources** and **Data Sources**: described using a Terraform Type Schema, which is a `map[string]Attribute`, where an Attribute could be _Primitive_, _Composite_, or _List_.
2. **Create**, **Read**, **Update** and **Delete** methods: the interface through which the provider interacts with an external resource (usually an API) to reconcile a desired terraform specification with the actual state of the resource.
3. **Plan Validators**: defined to enable the validation of a desired specification at Plan-time, without making API calls to the external resource.
4. **Plan Modifiers**: defined to enable custom semantics around the Terraform Type Schema, and how it is reconciled with the external state to make a Plan.
5. **Resource imports**: defined to enable Terraform Specifications to be generated from existing resources.

## A Simple CRUD Example

Let's explore how to define a resource and map API operations to Terraform methods using annotations for CRUD actions.

### Defining a Resource

Use `x-speakeasy-entity` to define a resource Terraform should manage.

```yaml
/drinks:
  post:
    x-speakeasy-entity-operation: Drink#create
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Drink"
    responses:
      "200":
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Drink"
/drinks/{id}:
  parameters:
    - name: id
      in: path
      required: true
      schema:
        type: string
  get:
    x-speakeasy-entity-operation: Drink#read
    responses:
      "200":
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Drink"
  post:
    x-speakeasy-entity-operation: Drink#update
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Drink"
    responses:
      "200":
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Drink"
  delete:
    x-speakeasy-entity-operation: Drink#delete
    responses:
      "202":
        description: OK
components:
  schemas:
    Drink:
      x-speakeasy-entity: Drink
      type: object
      properties:
        name:
          description: The name of the drink.
          type: string
          examples:
            - Old Fashioned
            - Manhattan
            - Negroni
        type:
          $ref: "#/components/schemas/DrinkType"
        price:
          description: The price of one unit of the drink in US cents.
          type: number
          examples:
            - 1000 # $10.00
            - 1200 # $12.00
            - 1500 # $15.00
      required:
        - name
        - price
```

### Mapping API Operations to Resources Methods

An OpenAPI specification tracks a large list of Operation objects.

For a Terraform Provider generated by Speakeasy, the key element is the `x-speakeasy-entity-operation` annotation. This annotation clarifies the purpose of each operation in terms of how it affects the associated remote entity.

**Valid operation types:**

| Operation | Description |
|-----------|-------------|
| `create` | Creates a new resource instance |
| `read` | Retrieves the current state of a resource |
| `update` | Modifies an existing resource |
| `delete` | Removes a resource |

> **Warning:** Only `create`, `read`, `update`, and `delete` are valid operation types. Using `#list` or other operation types will cause validation errors:
> ```text
> ERROR: failed to parse x-speakeasy-entity-operation string: invalid entity operation type: list, valid types are: create, read, update, delete
> ```
> List operations (GET on collection endpoints like `/resources`) should NOT have `x-speakeasy-entity-operation` annotations. They can be used for data sources with a separate entity name (e.g., `Resources#read` for a plural data source).

```yaml
/drinks:
  post:
    x-speakeasy-entity-operation: Drink#create
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Drink"
    responses:
      "200":
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Drink"
/drinks/{id}:
  parameters:
    - name: id
      in: path
      required: true
      schema:
        type: string
  get:
    x-speakeasy-entity-operation: Drink#read
    responses:
      "200":
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Drink"
  post:
    x-speakeasy-entity-operation: Drink#update
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/Drink"
    responses:
      "200":
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Drink"
  delete:
    x-speakeasy-entity-operation: Drink#delete
    responses:
      "202":
        description: OK
components:
  schemas:
    Drink:
      x-speakeasy-entity: Drink
      type: object
      properties:
        name:
          description: The name of the drink.
          type: string
          examples:
            - Old Fashioned
            - Manhattan
            - Negroni
        id:
          description: The ID of the drink
          readOnly: true
          type: string
        type:
          $ref: "#/components/schemas/DrinkType"
        price:
          description: The price of one unit of the drink in US cents.
          type: number
          examples:
            - 1000 # $10.00
            - 1200 # $12.00
            - 1500 # $15.00
      required:
        - name
        - price
```

## Managing Complex API Semantics with Speakeasy

APIs can have unique semantics not fully described by OpenAPI specs. To address this, Speakeasy provides:

1. **Inference Rules**: Automatically derive most API semantics from the OpenAPI spec, with the exception of the `x-speakeasy-entity-operation` annotation.
2. **OpenAPI Extensions**: For more complex cases, use extensions to provide detailed configurations. These extensions are documented in the Terraform customization documentation.
3. **Support**: Our engineering team continually updates inference rules and extensions to accommodate new API patterns.

---

## Pre-defined TODO List

When mapping CRUD operations for Terraform, initialize your TODO list with:

| Step | TODO Item | Active Form |
|------|-----------|-------------|
| 1 | Identify entities to manage with Terraform | Identifying Terraform entities |
| 2 | Add x-speakeasy-entity to schema definitions | Adding x-speakeasy-entity |
| 3 | Map POST operations to create with x-speakeasy-entity-operation | Mapping create operations |
| 4 | Map GET operations to read with x-speakeasy-entity-operation | Mapping read operations |
| 5 | Map PUT/PATCH operations to update with x-speakeasy-entity-operation | Mapping update operations |
| 6 | Map DELETE operations to delete with x-speakeasy-entity-operation | Mapping delete operations |
| 7 | Validate CRUD mapping completeness | Validating CRUD mapping |

**Usage:**
```javascript
TodoWrite([
  {content: "Identify entities to manage with Terraform", status: "pending", activeForm: "Identifying Terraform entities"},
  {content: "Add x-speakeasy-entity to schema definitions", status: "pending", activeForm: "Adding x-speakeasy-entity"},
  {content: "Map POST operations to create with x-speakeasy-entity-operation", status: "pending", activeForm: "Mapping create operations"},
  {content: "Map GET operations to read with x-speakeasy-entity-operation", status: "pending", activeForm: "Mapping read operations"},
  {content: "Map PUT/PATCH operations to update with x-speakeasy-entity-operation", status: "pending", activeForm: "Mapping update operations"},
  {content: "Map DELETE operations to delete with x-speakeasy-entity-operation", status: "pending", activeForm: "Mapping delete operations"},
  {content: "Validate CRUD mapping completeness", status: "pending", activeForm: "Validating CRUD mapping"}
])
```

