# SDK Generation Tests
# These tests verify that skills guide successful SDK generation
#
# Compilation modes:
#   - quick: Fast type/syntax checks only (2-15s per target)
#   - full: Complete build with dependencies (30-120s per target)

tests:
  - name: typescript-sdk-from-clean-spec
    skill: start-new-sdk-project  # Primary SDK generation skill
    type: generation
    target: typescript
    spec_file: fixtures/petstore-minimal.yaml
    verify_compilation: true
    compile_mode: quick  # Uses tsc --noEmit instead of npm run build
    verify_workflow: true
    verify_gen_yaml: false  # gen.yaml sometimes missing due to Speakeasy bug
    max_turns: 25  # SDK generation needs more turns
    task: |
      Generate a TypeScript SDK from the OpenAPI spec at openapi.yaml.
      Run: speakeasy quickstart --skip-interactive --output console -s openapi.yaml -t typescript -n "PetstoreSDK" -p "petstore-sdk"

  - name: python-sdk-from-clean-spec
    skill: start-new-sdk-project  # Primary SDK generation skill
    type: generation
    target: python
    spec_file: fixtures/petstore-minimal.yaml
    verify_compilation: true
    compile_mode: quick  # Uses python -m compileall
    verify_workflow: true
    verify_gen_yaml: false  # gen.yaml sometimes missing due to Speakeasy bug
    max_turns: 25  # SDK generation needs more turns
    task: |
      Generate a Python SDK from the OpenAPI spec at openapi.yaml.
      Run: speakeasy quickstart --skip-interactive --output console -s openapi.yaml -t python -n "PetstoreSDK" -p "petstore-sdk"

  - name: go-sdk-from-clean-spec
    skill: start-new-sdk-project  # Primary SDK generation skill
    type: generation
    target: go
    spec_file: fixtures/petstore-minimal.yaml
    verify_compilation: true
    compile_mode: quick  # Uses go vet instead of go build
    verify_workflow: true
    verify_gen_yaml: false  # gen.yaml sometimes missing due to Speakeasy bug
    max_turns: 25  # SDK generation needs more turns
    task: |
      Generate a Go SDK from the OpenAPI spec at openapi.yaml.
      Run: speakeasy quickstart --skip-interactive --output console -s openapi.yaml -t go -n "PetstoreSDK" -p "petstore-sdk"

  - name: typescript-sdk-with-pagination
    skill: manage-openapi-overlays
    type: generation
    target: typescript
    spec_file: fixtures/paginated-api.yaml
    verify_compilation: true
    compile_mode: quick
    verify_workflow: true
    verify_gen_yaml: false  # gen.yaml sometimes missing due to Speakeasy bug
    max_turns: 30  # More complex - overlay + generation
    task: |
      Generate a TypeScript SDK from this paginated API spec at openapi.yaml.
      First create an overlay file that adds x-speakeasy-pagination extensions for the list endpoints,
      then run: speakeasy quickstart --skip-interactive --output console -s openapi.yaml -t typescript -n "PaginatedSDK" -p "paginated-sdk"
      Do not edit the spec directly - create an overlay file.

  - name: typescript-sdk-with-hooks
    skill: customize-sdk-hooks
    type: generation
    target: typescript
    spec_file: fixtures/petstore-minimal.yaml
    verify_compilation: true
    compile_mode: quick
    verify_workflow: true
    verify_gen_yaml: false  # gen.yaml sometimes missing due to Speakeasy bug
    verify_hooks: true
    max_turns: 30  # Generation + hooks customization
    task: |
      Generate a TypeScript SDK and implement custom SDK hooks.
      First run: speakeasy quickstart --skip-interactive --output console -s openapi.yaml -t typescript -n "HooksSDK" -p "hooks-sdk"
      Then add a beforeRequest hook in the hooks directory that adds a custom header.

  - name: typescript-sdk-with-mcp
    skill: generate-mcp-server
    type: generation
    target: typescript
    spec_file: fixtures/petstore-minimal.yaml
    verify_compilation: true
    compile_mode: quick
    verify_workflow: true
    verify_gen_yaml: false  # gen.yaml sometimes missing due to Speakeasy bug
    verify_mcp: true
    max_turns: 30  # Generation + MCP config
    task: |
      Generate a TypeScript SDK with MCP server support.
      Run: speakeasy quickstart --skip-interactive --output console -s openapi.yaml -t typescript -n "McpSDK" -p "mcp-sdk"
      Enable MCP server generation in gen.yaml by setting enableMCPServer: true.

  - name: multi-target-sdk-generation
    skill: orchestrate-multi-target-sdks
    type: generation
    target: typescript
    spec_file: fixtures/petstore-minimal.yaml
    verify_compilation: true
    compile_mode: quick
    verify_workflow: true
    verify_gen_yaml: false  # gen.yaml sometimes missing due to Speakeasy bug
    verify_multi_target: true
    max_turns: 35  # Multi-target is complex
    task: |
      Generate SDKs for multiple language targets (TypeScript and Python) from a single OpenAPI spec.
      First run: speakeasy quickstart --skip-interactive --output console -s openapi.yaml -t typescript -n "MultiSDK" -p "multi-sdk"
      Then configure the workflow.yaml to add a second Python target.
