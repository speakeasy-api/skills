# End-to-End Workflow Tests
# These tests verify complete SDK generation workflows
# Phase 1: Validates workflow structure and multi-step operations

tests:
  - name: full-typescript-workflow
    skill: start-new-sdk-project
    type: workflow
    target: typescript
    spec_file: fixtures/petstore-minimal.yaml
    task: |
      Complete the full SDK generation workflow:
      1. Lint the OpenAPI spec to check for issues
      2. Generate a TypeScript SDK using speakeasy quickstart
      3. Verify the SDK was created successfully
    steps:
      - name: lint-spec
        command: speakeasy lint
      - name: generate-sdk
        command: speakeasy quickstart
      - name: verify-workflow
        creates_file: .speakeasy/workflow.yaml

  - name: overlay-then-generate
    skill: improve-sdk-naming
    type: workflow
    spec_file: fixtures/petstore-poor-naming.yaml
    task: |
      Get AI-powered naming suggestions and generate an SDK:
      1. Analyze the spec with speakeasy lint
      2. Run speakeasy suggest to generate AI-powered naming improvements
      3. Create the SDK with the improved naming
    steps:
      - name: lint-spec
        command: speakeasy lint
      - name: suggest-names
        command: speakeasy suggest

  - name: lint-fix-generate-workflow
    skill: diagnose-generation-failure
    type: workflow
    spec_file: fixtures/petstore-poor-naming.yaml
    task: |
      SDK generation is failing with validation errors. Diagnose and fix:
      1. Run speakeasy lint to identify the root cause
      2. Create an overlay to fix the validation issues
      3. Regenerate the SDK to verify the fix worked
    steps:
      - name: lint-spec
        command: speakeasy lint
      - name: create-overlay
        creates_file: overlay.yaml
      - name: generate-sdk
        command: speakeasy quickstart

  # Disabled: merge-openapi-specs skill does not exist yet
  # - name: multi-spec-merge-workflow
  #   skill: merge-openapi-specs
  #   type: workflow
  #   spec_file: fixtures/petstore-minimal.yaml
  #   task: |
  #     Merge multiple OpenAPI specs and generate a unified SDK:
  #     1. Validate both input specs with lint
  #     2. Merge the specs using speakeasy merge
  #     3. Generate the SDK from the merged spec
  #   steps:
  #     - name: lint-first-spec
  #       command: speakeasy lint
  #     - name: merge-specs
  #       command: speakeasy merge
  #     - name: generate-sdk
  #       command: speakeasy run
